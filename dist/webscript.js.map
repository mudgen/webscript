{"version":3,"file":"webscript.js","sources":["../src/webscript.js"],"sourcesContent":["function templateValues(args) {\r\n  const [strings, ...templateArgs] = args;\r\n  const result = [];\r\n  for (const [index, s] of strings.entries()) {\r\n    if (s !== \"\") {\r\n      result.push(s);\r\n    }\r\n    let arg = templateArgs[index];\r\n    if (typeof arg !== \"undefined\") {\r\n      result.push(arg);\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nlet interpunct = new RegExp(\"·\", \"g\");\r\n\r\nexport const enhanceBuilder = (builder, func) => {\r\n  builder.__webscript_enhancer = func;\r\n  return builder;\r\n}\r\n\r\nfunction createInitialBuilder(constructor, type) {\r\n  function createBuilder(props, prop) {\r\n    let builder = new Proxy(() => { }, {\r\n      apply(target, thisArg, children) {\r\n        if (typeof target.__webscript_enhancer === \"function\") {\r\n          let __webscript_enhancer = target.__webscript_enhancer;\r\n          delete target.__webscript_enhancer;\r\n          let result = __webscript_enhancer(builder, children);\r\n          target.__webscript_enhancer = __webscript_enhancer;\r\n          return result;\r\n        }\r\n        let [first] = children;\r\n        if (Array.isArray(first) && Object.isFrozen(first)) {\r\n          children = templateValues(children);\r\n        }\r\n        if (Array.isArray(props.children)) {\r\n          props.children.push(...children)\r\n          children = props.children;\r\n          delete props.children;\r\n        }\r\n        for (let i = 0; i < children.length; i++) {\r\n          let arg = children[i];\r\n          if (typeof arg === \"function\" && arg.__is_webscript_element === true) {\r\n            children[i] = arg();\r\n          }\r\n        }\r\n        return constructor(type, props, ...children);\r\n      },\r\n      get(target, elementName) {\r\n        if (typeof elementName === \"string\") {\r\n          if (elementName === \"__is_webscript_element\") {\r\n            return true;\r\n          }\r\n          else if (elementName === \"__webscript_enhancer\") {\r\n            return target[elementName]\r\n          }\r\n          else if (elementName.indexOf(\"·\") !== -1) {\r\n            elementName = elementName.replace(interpunct, \"-\");\r\n          }\r\n\r\n          function setPropertyValue(...args) {\r\n            let [value] = args;\r\n            if (typeof value === \"undefined\") {\r\n              if (prop === \"props\" && Object.prototype.toString.call(value) === '[object Object]') {\r\n                return createBuilder({}, null);\r\n              }\r\n              let newProps = { ...props };\r\n              delete newProps[prop];\r\n              return createBuilder(newProps, null);\r\n            }\r\n            else if (Array.isArray(value) && Object.isFrozen(value)) {\r\n              value = templateValues(args).join(\"\");\r\n            }\r\n            else if (args.length > 1) {\r\n              value = args;\r\n            }\r\n            else if (prop === \"props\" && Object.prototype.toString.call(value) === '[object Object]') {\r\n              return createBuilder({ ...props, ...value }, null);\r\n            }\r\n            const newProps = { ...props, [prop]: value };\r\n            return createBuilder(newProps, null);\r\n          }\r\n          if (elementName === \"props\") {\r\n            setPropertyValue.value = props;\r\n          }\r\n          else {\r\n            setPropertyValue.value = props[elementName];\r\n          }\r\n          prop = elementName;\r\n          return setPropertyValue;\r\n        }\r\n      }\r\n    })\r\n    return builder;\r\n  }\r\n  return createBuilder({}, null);\r\n}\r\n\r\n\r\nfunction builders(constructor, types = []) {\r\n  if (typeof constructor !== \"function\") {\r\n    throw Error(\"elementConstructor argument must be present and it must be a function.\");\r\n  }\r\n  if (types.length > 0) {\r\n    let builders = [];\r\n    for (const type of types) {\r\n      builders.push(createInitialBuilder(constructor, type));\r\n    }\r\n    return builders;\r\n  }\r\n  else {\r\n    return new Proxy(() => { }, {\r\n      get(target, prop) {\r\n        const result = target[prop];\r\n        if (typeof result !== \"undefined\") {\r\n          return result;\r\n        }\r\n        target[prop] = createInitialBuilder(constructor, prop);\r\n        return target[prop];\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport default builders;\r\n\r\n"],"names":["templateValues","args","strings","templateArgs","result","entries","index","s","push","arg","interpunct","RegExp","createInitialBuilder","constructor","type","createBuilder","props","prop","builder","Proxy","apply","target","thisArg","children","__webscript_enhancer","first","Array","isArray","Object","isFrozen","i","length","__is_webscript_element","get","elementName","setPropertyValue","value","prototype","toString","call","newProps","join","indexOf","replace","types","Error","builders","func"],"mappings":"8gCAAA,SAASA,EAAeC,GAGtB,UAFOC,EAA4BD,KAAhBE,EAAgBF,WAC7BG,EAAS,OACUF,EAAQG,0BAAW,eAAhCC,OAAOC,OACP,KAANA,GACFH,EAAOI,KAAKD,GAEd,IAAIE,EAAMN,EAAaG,QACJ,IAARG,GACTL,EAAOI,KAAKC,GAGhB,OAAOL,EAGT,IAAIM,EAAa,IAAIC,OAAO,IAAK,KAOjC,SAASC,EAAqBC,EAAaC,GA2EzC,OA1EA,SAASC,EAAcC,EAAOC,GAC5B,IAAIC,EAAU,IAAIC,MAAM,aAAW,CACjCC,eAAMC,EAAQC,EAASC,GACrB,GAA2C,mBAAhCF,EAAOG,qBAAqC,CACrD,IAAIA,EAAuBH,EAAOG,4BAC3BH,EAAOG,qBACd,IAAIpB,EAASoB,EAAqBN,EAASK,GAE3C,OADAF,EAAOG,qBAAuBA,EACvBpB,EANsB,MAQ1BqB,EAASF,KACVG,MAAMC,QAAQF,IAAUG,OAAOC,SAASJ,KAC1CF,EAAWvB,EAAeuB,IAExBG,MAAMC,QAAQX,EAAMO,eACtBP,EAAMO,UAASf,aAAQe,GACvBA,EAAWP,EAAMO,gBACVP,EAAMO,UAEf,IAAK,IAAIO,EAAI,EAAGA,EAAIP,EAASQ,OAAQD,IAAK,CACxC,IAAIrB,EAAMc,EAASO,GACA,mBAARrB,IAAqD,IAA/BA,EAAIuB,yBACnCT,EAASO,GAAKrB,KAGlB,OAAOI,gBAAYC,EAAME,UAAUO,KAErCU,aAAIZ,EAAQa,GACV,GAA2B,iBAAhBA,EAA0B,KAW1BC,EAAT,iBAA6BlC,2BACtBmC,EAASnC,KACd,QAAqB,IAAVmC,EAAuB,CAChC,GAAa,UAATnB,GAA8D,oBAA1CW,OAAOS,UAAUC,SAASC,KAAKH,GACrD,OAAOrB,EAAc,GAAI,MAE3B,IAAIyB,OAAgBxB,GAEpB,cADOwB,EAASvB,GACTF,EAAcyB,EAAU,SAExBd,MAAMC,QAAQS,IAAUR,OAAOC,SAASO,GAC/CA,EAAQpC,EAAeC,GAAMwC,KAAK,YAE3BxC,EAAK8B,OAAS,EACrBK,EAAQnC,UAEQ,UAATgB,GAA8D,oBAA1CW,OAAOS,UAAUC,SAASC,KAAKH,GAC1D,OAAOrB,OAAmBC,EAAUoB,GAAS,MAE/C,IAAMI,OAAgBxB,UAAQC,GAAOmB,MACrC,OAAOrB,EAAcyB,EAAU,OA9BjC,MAAoB,2BAAhBN,IAGqB,yBAAhBA,EACAb,EAAOa,KAEuB,IAA9BA,EAAYQ,QAAQ,OAC3BR,EAAcA,EAAYS,QAAQjC,EAAY,MA0B9CyB,EAAiBC,MADC,UAAhBF,EACuBlB,EAGAA,EAAMkB,GAEjCjB,EAAOiB,EACAC,QAIb,OAAOjB,EAEFH,CAAc,GAAI,sBAI3B,SAAkBF,EAAa+B,GAC7B,YAD6BA,IAAAA,EAAQ,IACV,mBAAhB/B,EACT,MAAMgC,MAAM,0EAEd,GAAID,EAAMb,OAAS,EAAG,CAEpB,IADA,MAAIe,EAAW,OACIF,kBACjBE,EAAStC,KAAKI,EAAqBC,YAErC,OAAOiC,EAGP,WAAW3B,MAAM,aAAW,CAC1Bc,aAAIZ,EAAQJ,GACV,IAAMb,EAASiB,EAAOJ,GACtB,YAAsB,IAAXb,EACFA,GAETiB,EAAOJ,GAAQL,EAAqBC,EAAaI,GAC1CI,EAAOJ,+BAvGQ,SAACC,EAAS6B,GAEtC,OADA7B,EAAQM,qBAAuBuB,EACxB7B"}